# pnpm Setup for SignOnDuty Frontend

## What Changed

The frontend now uses **pnpm** for dependency management instead of npm. This provides:
- ✅ Faster package installation
- ✅ Better monorepo support
- ✅ Cleaner node_modules structure
- ✅ Similar to Go's dependency management (go.sum)

## Key Files Created/Updated

### Configuration Files
- **package.json**: Updated with `"type": "module"` and `"packageManager": "pnpm@latest"`
- **pnpm-lock.yaml**: Lock file (equivalent to go.sum) - **MUST commit to git**
- **.npmrc**: pnpm configuration file
- **.prettierrc**: Code formatting rules
- **.prettierignore**: Files to ignore during formatting
- **.eslintrc.cjs**: ESLint configuration
- **.gitignore**: Git ignore rules

### SvelteKit Configuration
- **src/app.html**: Main HTML template
- **src/styles.css**: Global styles with TailwindCSS
- **src/routes/+layout.svelte**: Root layout component
- **src/routes/+page.ts**: Page load function
- **src/routes/+page.svelte**: Main page component (already created)
- **svelte.config.js**: SvelteKit configuration
- **vite.config.js**: Vite build configuration
- **tsconfig.json**: TypeScript configuration
- **tailwind.config.js**: TailwindCSS configuration

### Build Artifacts
- **.svelte-kit/**: Generated SvelteKit artifacts (auto-generated)
- **build/**: Production build output (generated by `pnpm run build`)
- **node_modules/**: Installed dependencies (207 packages)

## Common Commands

```bash
# Navigate to frontend
cd frontend

# Install dependencies (like go mod download)
pnpm install

# Equivalent to "go mod tidy" - clean up unused deps
pnpm run tidy

# Development server (http://localhost:5173)
pnpm run dev

# Production build
pnpm run build

# Preview production build
pnpm run preview

# Code formatting
pnpm run format

# Linting
pnpm run lint

# Type checking
pnpm run check
```

## Dependency Status

✅ **Build Status**: SUCCESS
- Build completed in 3.79 seconds
- Successfully generated production bundle
- All dependencies resolved correctly

## File Structure

```
frontend/
├── src/
│   ├── app.html              # Main HTML template
│   ├── styles.css            # Global styles
│   └── routes/
│       ├── +layout.svelte    # Root layout
│       ├── +page.svelte      # Home page
│       ├── +page.ts          # Page load function
│       └── $types.d.ts       # Generated types
├── .svelte-kit/              # Generated (auto)
├── .svelte-kit/output/       # Build artifacts
├── node_modules/             # 207 packages installed
├── package.json              # Dependencies
├── pnpm-lock.yaml            # Lock file (COMMIT THIS!)
├── vite.config.js            # Build config
├── svelte.config.js          # SvelteKit config
├── tsconfig.json             # TypeScript config
├── tailwind.config.js        # Tailwind config
├── .npmrc                     # pnpm config
├── .eslintrc.cjs             # ESLint config
├── .prettierrc                # Prettier config
├── Dockerfile                # Container build
└── .gitignore                # Git rules
```

## Integration with Backend

The frontend is configured to connect to the backend at:
- **Development**: `http://localhost:8443/api/v1` (defined in docker-compose)
- **Production**: `https://signonduty.mil/api/v1` (configurable)

The environment variable `VITE_API_URL` controls this.

## Docker Support

Build the frontend Docker image:
```bash
docker build -t signonduty-frontend:latest frontend/
```

Or use docker-compose:
```bash
docker-compose up frontend
```

The Dockerfile uses pnpm and includes multi-stage build for optimization.

## Next Steps

1. **Run Development Server**:
   ```bash
   cd frontend && pnpm run dev
   ```
   Then open http://localhost:5173

2. **Test Frontend + Backend Together**:
   ```bash
   # Terminal 1: Backend
   cd .. && go run cmd/server/main.go

   # Terminal 2: Frontend
   cd frontend && pnpm run dev
   ```

3. **Build for Production**:
   ```bash
   pnpm run build && pnpm run preview
   ```

## Troubleshooting

### Issue: "Cannot switch to pnpm@latest"
This is a warning only. Your current pnpm version is fine. To update:
```bash
pnpm self-update
```

### Issue: Build errors
1. Ensure Node.js 18+ is installed: `node --version`
2. Ensure pnpm is installed: `pnpm --version`
3. Reinstall: `pnpm install --force`

### Issue: Changes not reflecting
Clear cache:
```bash
pnpm run build --force
rm -rf .svelte-kit node_modules
pnpm install
```

---

**Lock file**: `pnpm-lock.yaml` (IMPORTANT: Commit to git!)
**Package manager**: pnpm 10.13.1+
**Node version**: 18 (pinned for Docker)
